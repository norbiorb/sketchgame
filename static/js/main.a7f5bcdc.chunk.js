(this.webpackJsonpsketch=this.webpackJsonpsketch||[]).push([[0],{33:function(e,t,n){e.exports=n(56)},44:function(e,t){},45:function(e,t){},46:function(e,t){},47:function(e,t){},48:function(e,t){},49:function(e,t){},50:function(e,t,n){},55:function(e){e.exports=JSON.parse('["bird","book","car","cat","chair","flower","plane","sheep","ship","strawberry"]')},56:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),o=n(26),c=n.n(o),s=n(9),i=n(10),l=n(8),u=n.n(l),d=n(14),f=n(16);function m(){return(m=Object(d.a)(u.a.mark((function e(){return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Model loading..."),e.next=3,f.c("./model/model.json").then(console.log("Loaded.")).catch((function(e){return console.log(e)}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}n(50);var p=function(){return r.a.createElement("section",{className:"nes-container is-dark"},r.a.createElement("h2",null,"Sketch"),r.a.createElement("article",{key:"game"},r.a.createElement("p",null,"This game has been modeled-off Google's \xa0",r.a.createElement("a",{href:"https://quickdraw.withgoogle.com"},"Quick, Draw! ")," game, and uses a sampling from the Quick Draw! ",r.a.createElement("a",{href:"https://quickdraw.withgoogle.com/data"},"dataset"),"."),r.a.createElement("p",null,"Brought to you by the EPFL Extension School.")),r.a.createElement("footer",null,r.a.createElement(s.b,{className:"nes-btn",to:"/game"},"Play Game")))},h=n(2),b=n(4);function v(e,t){var n=function(e){return f.b.fromPixels(e.current).resizeNearestNeighbor([28,28]).mean(2).expandDims(2).expandDims().toFloat().div(255)}(e);return t.then((function(e){return e.predict(n).data()})).then(function(){var e=Object(d.a)(u.a.mark((function e(t){var n,a;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f.a(t).data();case 2:return n=e.sent,a=t[n],console.log("getPrediction: prediction index: ".concat(n," with confidence ").concat(a)),e.abrupt("return",n);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}function g(e){for(var t=e.length,n=Array.from(Array(t).keys()),a=new Array(t),r=0;r<t-1;r++){var o=r+Math.floor(Math.random()*(t-r)),c=n[o];n[o]=n[r],n[r]=c}for(var s=0;s<t;s++)a[n[s]]=e[s];return[a,n]}var w=n(12),y=n.n(w),E=function(e){var t=Object(a.useContext)(x),n=t.timerRef,o=t.setTime,c=e.strings,s=c.answer,i=c.questionStart,l=c.secondsPerRound,u=c.questionEnd,d=Object(a.useState)(!1),f=Object(b.a)(d,2),m=f[0],p=f[1],v=O(l,e.callback,m),g=Object(b.a)(v,1)[0];return Object(a.useEffect)((function(){var e={typeSpeed:20,contentType:"html",showCursor:!0,cursorChar:" "};if(m)o(n,g);else{var t=Object(h.a)(Object(h.a)({},e),{},{strings:[s],onComplete:function(){return l.start()}}),a=Object(h.a)(Object(h.a)({},e),{},{strings:[i],onComplete:function(){return d.start()}}),r=Object(h.a)(Object(h.a)({},e),{},{strings:["".concat(g)],onComplete:function(){return f.start()}}),c=Object(h.a)(Object(h.a)({},e),{},{strings:[u],onComplete:function(){return p(!0)}});new y.a("#typed1",t).start();var l=new y.a("#typed2",a);l.stop();var d=new y.a("#typed3",r);d.stop();var f=new y.a("#typed4",c);f.stop()}return function(){}}),[s,m,u,i,g,o,n]),r.a.createElement("div",null,r.a.createElement("span",{className:"typed",id:"typed1"}),r.a.createElement("span",{className:"typed",id:"typed2"}),r.a.createElement("span",{ref:n,className:"typed",id:"typed3"}),r.a.createElement("span",{className:"typed",id:"typed4"}))},O=function(e,t,n){var r=Object(a.useState)(e),o=Object(b.a)(r,2),c=o[0],s=o[1];return Object(a.useEffect)((function(){var e;return n&&(e=setInterval((function(){c<=0?(t(c),clearInterval(e)):s((function(e){return e-1}))}),1e3)),function(){e&&clearInterval(e)}}),[c,t,n]),[c]},j=function(e){var t=Object(a.useContext)(x).handleTimeout,n=e.state,o=n.currentLabel;return r.a.createElement("div",{className:"status-text"},r.a.createElement(E,{key:o,label:o,strings:Object(h.a)({},n.texts),callback:t}))},k=r.a.forwardRef((function(){var e,t,n=Object(a.useContext)(q).ref,o=Object(a.useContext)(x).handlePrediction,c=!1;return Object(a.useEffect)((function(){!function(e){var t=e.current,n=t.getContext("2d");n.fillStyle="#ffffff",n.fillRect(0,0,t.height,t.width)}(n)}),[n]),r.a.createElement("canvas",{className:"canvas",height:300,width:300,ref:n,onMouseDown:function(){return c=!0},onMouseUp:function(){o(),c=!1,e=void 0,t=void 0},onMouseMove:function(n){return function(n){var a=n.target.getBoundingClientRect(),r=n.clientX-a.left,o=n.clientY-a.top;if(c){var s=function(e,t,n,a,r){var o=e.getContext("2d");return o.strokeStyle="#000000",o.lineWidth=12,o.lineJoin="round",o.beginPath(),o.moveTo(a,r),o.lineTo(t,n),o.closePath(),o.stroke(),[t,n]}(n.target,r,o,e,t),i=Object(b.a)(s,2);e=i[0],t=i[1]}}(n)},style:{backgroundColor:"#ffffff"}})}));function R(){var e=Object(a.useContext)(q).ref;return r.a.createElement("div",{className:"controls"},r.a.createElement("button",{className:"nes-btn is-warning controls-button",onClick:function(){var t=e.current;t.getContext("2d").fillRect(0,0,t.height,t.width)}},"Clear Canvas"))}var x=Object(a.createContext)({}),C=function(){var e=Object(a.useContext)(q),t=e.toggleGameEnded,n=e.labels,o=e.indices,c=e.dispatchPoints,i=e.model,l=e.secondsPerRound,f=e.ref,m=e.bonustime,p=e.CORRECT,g=e.TIMEDOUT,w=Object(a.useRef)(),y={activeRound:0,currentlabel:n[0],secondsPerRound:l,label:"",result:"",timeUsed:l.toString(),points:0,texts:{answer:"Let's start",questionStart:"You have",questionEnd:"seconds to draw a ".concat(n[0]," in the canvas on the left."),secondsPerRound:l.toString()}},E=N(n,(function(e,t){var a=t.type,r=t.payload;switch(a){case"increment":var o=Object(h.a)(Object(h.a)({},e),{},{label:r.label,result:r.result,timeUsed:r.timeUsed,activeRound:e.activeRound+1,currentLabel:n[e.activeRound+1]}),c={answer:o.result===p?o.timeUsed<=m?"You know you made an awsome ".concat(o.label," sketch in only ").concat(o.timeUsed," seconds!"):"Well Done! You draw a ".concat(o.label," in ").concat(o.timeUsed," seconds. Can you do faster? "):o.result===g?"You run out of time when drawing a ".concat(o.label,". "):"",questionStart:"You have now",questionEnd:"seconds to draw a ".concat(n[o.activeRound]),secondsPerRound:l.toString()};return o.texts=c,o;default:return e}}),y),O=Object(b.a)(E,3),j=O[0],C=O[1],S=O[2],P=C.activeRound;Object(a.useEffect)((function(){P===n.length&&t()}),[P,t,n]);var T=j[P],U=Object(a.useState)(""),L=Object(b.a)(U,2),M=L[0],W=L[1],Y=function(e){var t=e.current;t.getContext("2d").fillRect(0,0,t.height,t.width)},A=function(e){var t=n[P],a=n[o[e[0]]];console.log("Predicted Label: ",a),t===a&&function(){var e=parseInt(function(e){return e.current.innerHTML}(w));if(!Number.isNaN(e)){var t=l-e;W(p),c({type:"increment",payload:{timeUsed:t}}),Y(f),S({type:"increment",payload:{label:n[P],result:p,timeUsed:t}})}}()},D=function(){var e=Object(d.a)(u.a.mark((function e(){var t;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,v(f,i);case 2:t=e.sent,A(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return r.a.createElement("div",{className:"nes-container with-title is-dark"},r.a.createElement("h2",{className:"title"},"Sketch Round ",P+1," of ",n.length," Rounds"),r.a.createElement("header",{className:"header"},r.a.createElement(s.b,{className:" nes-btn",to:"/"},"Home")),r.a.createElement(x.Provider,{value:{activeRound:P,dispatchActiveRound:S,roundState:C,result:M,setResult:W,timerRef:w,setTime:function(e,t){e.current.innerHTML=t},handlePrediction:D,handleTimeout:function(e){e<=0&&(Y(f),W(g),S({type:"increment",payload:{label:n[P],result:g,timeUsed:l}}))}}},r.a.createElement("main",{className:"main"},r.a.createElement("div",{className:"canvas-wrapper"},r.a.createElement(k,null)),r.a.createElement("div",{className:"status"},T,r.a.createElement(R,null)))))},N=function(e,t,n){var o=Object(a.useReducer)(t,n),c=Object(b.a)(o,2),s=c[0],i=c[1];return[Array.apply(null,e).map((function(e,t){return s.activeRound===t?r.a.createElement(j,{key:t,state:s}):null})),s,i]},S=n(29),P=n(30),T=n(32),U=n(31),L=function(e){Object(T.a)(n,e);var t=Object(U.a)(n);function n(){var e;Object(S.a)(this,n);for(var a=arguments.length,r=new Array(a),o=0;o<a;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).baseOptions={typeSpeed:20,showCursor:!1,contentType:"html"},e}return Object(P.a)(n,[{key:"componentDidMount",value:function(){var e=this.props.strings,t=Object(h.a)(Object(h.a)({},this.baseOptions),{},{strings:e});this.typed=new y.a(this.props.timerRef?this.props.timerRef:this.el,t),this.typed.start()}},{key:"componentWillUnmount",value:function(){this.typed&&this.typed.destroy()}},{key:"render",value:function(){var e=this;return r.a.createElement("span",{id:this.props.id?this.props.id:"",className:"typed",ref:this.props.timerRef?this.props.timerRef:function(t){e.el=t}})}}]),n}(r.a.Component),M=n(55),W=g(M),Y=Object(b.a)(W,2),A=Y[0],D=Y[1],q=Object(a.createContext)({}),I=Object(a.createRef)(),G={points:0,bonus:0},J=function(e,t){switch(t.type){case"increment":return t.payload.timeUsed<=5?{points:e.points+1,bonus:e.bonus+1}:Object(h.a)(Object(h.a)({},e),{},{points:e.points+1});case"reset":return G;default:return e}},B=function(e){var t=e.pointsState,n=e.maxPoints,a=t.points,o=t.bonus,c=a/n,s=c>=.75?"Great Job! You won! You did ".concat(a," out of ").concat(n," and too ").concat(o," bonus points for sketching fast! You like to play again?"):c<.75&&c>=.5?"You won! Not bad! You did ".concat(a," out of ").concat(n," with a bonus of ").concat(o," points for sketching fast. Like to improve and play again?"):"Whoops... you did ".concat(a," out of ").concat(n,"!  Your additional bonus is ").concat(o," points for sketching fast.Try harder and play again!");return r.a.createElement(L,{strings:[s]})},H=function(e){var t=e.model,n=M.length,o=Object(a.useReducer)(J,G),c=Object(b.a)(o,2),i=c[0],l=c[1],u=Object(a.useState)(!1),d=Object(b.a)(u,2),f=d[0],m=d[1],p=function(){if(f){var e=g(M),t=Object(b.a)(e,2);A=t[0],D=t[1],l({type:"reset"})}m(!f)};return r.a.createElement(q.Provider,{value:{model:t,ref:I,secondsPerRound:20,dispatchPoints:l,getPrediction:v,toggleGameEnded:p,labels:A,indices:D,STORE_RESULT:"storeResult",CORRECT:"correct",TIMEDOUT:"timedout",bonustime:5}},f?r.a.createElement("div",{className:"nes-container is-dark with-title"},r.a.createElement("h1",{className:"title"},"Sketch"),r.a.createElement("div",{className:"result"},r.a.createElement(B,{pointsState:i,maxPoints:n})),r.a.createElement("div",null,r.a.createElement("button",{className:"nes-btn is-warning flex-column",onClick:p},"Play again")),r.a.createElement("div",null,r.a.createElement(s.b,{className:"nes-btn ",to:"/"},"Home"))):r.a.createElement(C,{className:"nes-container is-dark"}))},F=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function Q(e,t){navigator.serviceWorker.register(e).then((function(e){e.onupdatefound=function(){var n=e.installing;null!=n&&(n.onstatechange=function(){"installed"===n.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),t&&t.onUpdate&&t.onUpdate(e)):(console.log("Content is cached for offline use."),t&&t.onSuccess&&t.onSuccess(e)))})}})).catch((function(e){console.error("Error during service worker registration:",e)}))}var z=function(e){var t=e.model;return r.a.createElement(s.a,{key:"game"},r.a.createElement(i.c,null,r.a.createElement(i.a,{exact:!0,path:"/",render:function(e){return r.a.createElement(p,Object.assign({},e,{model:t}))}}),r.a.createElement(i.a,{exact:!0,path:"/game",render:function(e){return r.a.createElement(H,Object.assign({},e,{model:t}))}})))};c.a.render(r.a.createElement(z,{model:function(){return m.apply(this,arguments)}()}),document.getElementById("root")),function(e){if("serviceWorker"in navigator){if(new URL("/project-react-c1-s8-3204-1657",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var t="".concat("/project-react-c1-s8-3204-1657","/service-worker.js");F?(!function(e,t){fetch(e,{headers:{"Service-Worker":"script"}}).then((function(n){var a=n.headers.get("content-type");404===n.status||null!=a&&-1===a.indexOf("javascript")?navigator.serviceWorker.ready.then((function(e){e.unregister().then((function(){window.location.reload()}))})):Q(e,t)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(t,e),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):Q(t,e)}))}}()}},[[33,1,2]]]);
//# sourceMappingURL=main.a7f5bcdc.chunk.js.map